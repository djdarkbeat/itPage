<?Lassoscript// Last modified 5/12/08 by ECL, Landmann InterActive// FUNCTIONALITY// User Record form// CHANGE NOTES// 8/17/06// Adding code to create a workgroup procedure// CHANGE NOTES// 10/12/07// Recoded for Clean URLs// 12/13/07// Changed assignment of Privileges so that Admin can assign them. They cannot assign Superadmin priv level.// 5/12/08// Ported changes from LBTIf: $svDebug == 'Y';	'<p class="debug"><strong>/admin/frm_user</strong></p>\n';/If;// Debugging// Var:'svDebug' = 'Y';// Defining the DataTypeVar:'vDataType' = 'User';// Convert action_paramsInclude:'user_params.inc';// If Edit page, get the recordIf: (Response_Filepath) >> 'setup_editrecord.lasso';	// If Process = Y, form was submit, so update the record	// Otherwise, it is a new edit so get the record	If: $vProcess != 'Y';		// Get the record		Var:'SQLGetUser' = 'SELECT * FROM ' $svUsersTable ' WHERE User_ID = "' $vUser_ID '" LIMIT 1';		Inline: $IV_Users, -Table=$svUsersTable, -SQL=$SQLGetUser;			If: $svDebug == 'Y';				'32: Error_CurrentError = ' (Error_CurrentError) '<br>\n';			/If;			// If Found_Count is wrong, the wrong User ID was passed, so dump out 2000 "No Record Found"				If: (Found_Count) == 0;				Var:'vError' = '2000';				LI_ShowError3: -ErrNum=(Var:'vError'), -Option=(Var:'vOption');				If: $svDebug == 'Y';					Include:($svLibsPath)'vardumpalpha.lasso';				/If;				Abort;			/If;			Var:'vUserprivs_PrivID' = Field:'Userprivs_PrivID';			Var:'vUser_LoginID' = Field:'User_LoginID';			Var:'vUser_FName' = Field:'User_FName';			Var:'vUser_LName' = Field:'User_LName';			Var:'vUser_Company' = Field:'User_Company';			Var:'vUser_Dept' = Field:'User_Dept';			Var:'vUser_Address1' = Field:'User_Address1';			Var:'vUser_Address2' = Field:'User_Address2';			Var:'vUser_City' = Field:'User_City';			Var:'vState_Abbrev' = Field:'States_StateAbbrev';			Var:'vUser_Zip' = Field:'User_Zip';			Var:'vUser_Country' = Field:'User_Country';			Var:'vUser_Email' = Field:'User_Email';			Var:'vUser_Notify' = Field:'User_Notify';			Var:'vUser_WorkPhone' = Field:'User_WorkPhone';			Var:'vUser_HomePhone' = Field:'User_HomePhone';			Var:'vUser_CellPhone' = Field:'User_CellPhone';			Var:'vUser_Fax' = Field:'User_Fax';			Var:'vUser_Website' = Field:'User_Website';			Var:'vUser_Chat' = Field:'User_Chat';			Var:'vUser_QuestionID' = Field:'User_QuestionID';			Var:'vUser_Answer' = Field:'User_Answer';			Var:'vUser_Comments' = Field:'User_Comments';			Var:'vUser_LastAccess' = Field:'User_LastAccess';			Var:'vUser_Active' = Field:'User_Active';		/Inline;	Else;		// Update the record		Inline: $IV_UpdateUser, 'User_ID' = $vUser_ID;			// If there is an error, dump out error 1012 "Update Failed"			If: (Error_CurrentError) != 0;				Var:'vError' = '1012';			/If;		/Inline;	/If;	/If;If: (Var:'vID') != '' || (Var:'vUser_ID') != '';	// Include the Upload User Photo Form	Include:'frm_uploaduserphoto.inc';	'<h2>'(LI_ShowIconByDataType)'&nbsp;&nbsp;Edit User</h2>\n';Else;	'<h2>'(LI_ShowIconByDataType)'&nbsp;&nbsp;Add User</h2>\n';/If;// Standard Error TableIf: (Var:'vError') != '';	LI_ShowError3: -ErrNum=(Var:'vError'), -Option=(Var:'vOption');/If;?> <form action="setup_addresponse.lasso" method="post">	<table border="0" cellpadding="5" width="520">		<tr>			<td colspan="2"><strong>NOTE: </strong>[$svInputRequired] indicates required information.</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Name[$svInputRequired]<br>					(First, Last)</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="FName" value="[Var:'vUser_FName']" size="16" maxlength="64"> 				<input type="text" name="LName" value="[Var:'vUser_LName']" size="24" maxlength="64"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Login ID[$svInputRequired]<br>					(Must be unique)</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="LoginID" value="[Var:'vUser_LoginID']" size="28" maxlength="64"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Password[If: (Response_Filepath) >> 'setup_add.lasso'][$svInputRequired][/If]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Pass" value="[If: (Response_Filepath) >> 'setup_add.lasso'][Var:'vUser_LoginPWTemp'][/If]" size="12" maxlength="18">[If: (Response_Filepath) >> 'setup_editrecord.lasso']Enter ONLY if you wish to change the password.[/If]			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">User Active[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<select name="Active"> 					<option value=""[If: (Var:'vUser_Active') == ''] selected[/If]></option>					<option value="Y"[If: (Var:'vUser_Active') == 'Y'] selected[/If]>Active</option>					<option value="N"[If: (Var:'vUser_Active') == 'N'] selected[/If]>Inactive</option>				</select>			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Question[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0"><?Lassoscript				Var:'SQLSearchQuestions' = 'SELECT * FROM ' $svQuestionsTable;				Inline: $IV_Questions,-SQL=$SQLSearchQuestions;					'\t\t\t\t<select name="Question">\n';					'\t\t\t\t\t<option value=""'; If: (Var:'vUser_QuestionID') == ''; ' selected'; /If; '></option>\n';					Records;						'\t\t\t\t\t<option value="'(Field:'Question_ID') '"'; If: (Var:'vUser_QuestionID') == (Field:'Question_ID'); ' selected'; /If; '>'(Field:'Question_Text')'</option>\n';					/Records;					'\t\t\t\t</select>\n';		        /Inline;?>			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Answer[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Answer" value="[Var:'vUser_Answer']" size="30" maxlength="128"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Privileges[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0"><?Lassoscript	Var:'SQLSearchPrivs' = 'SELECT * FROM ' $svUserPrivsTable;	Inline: $IV_UserPrivs,-SQL=$SQLSearchPrivs;		Var:'vError' = (Error_CurrentError);			'\t\t\t\t<select name="Privs">\n';			'\t\t\t\t\t<option value=""'; If: (Var:'vUserprivs_PrivID') == ''; ' selected'; /If; '></option>\n';			Records;				// If the logged-in user is a Superadmin, they can see all privileges				If: ($svUserPrivs_Priv) == 'Superadmin';					'\t\t\t\t\t<option value="'(Field:'UserPrivs_PrivID')'"'; If: (Var:'vUserprivs_PrivID') == (Field:'UserPrivs_PrivID'); ' selected'; /If; '>'(Field:'UserPrivs_Priv')'</option>\n';				// If the logged-in user is an Admin, do not let them see Superadmin as an option				Else:  ($svUserPrivs_Priv) == 'Admin';					If: !((Field:'UserPrivs_Priv')->Contains:'Superadmin');						'\t\t\t\t\t<option value="'(Field:'UserPrivs_PrivID')'"'; If: (Var:'vUserprivs_PrivID') == (Field:'UserPrivs_PrivID'); ' selected'; /If; '>'(Field:'UserPrivs_Priv')'</option>\n';					/If;				/If;		/Records;		'\t\t\t\t</select>\n';	/Inline;?>			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Company</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Company" value="[Var:'vUser_Company']" size="24" maxlength="64"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Department</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Dept" value="[Var:'vUser_Dept']" size="24" maxlength="32"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Work Phone</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="WorkPhone" value="[Var:'vUser_WorkPhone']" size="20" maxlength="32"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Home Phone</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="HomePhone" value="[Var:'vUser_HomePhone']" size="20" maxlength="32"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Cell Phone</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="CellPhone" value="[Var:'vUser_CellPhone']" size="20" maxlength="32"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Fax</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Fax" value="[Var:'vUser_Fax']" size="20" maxlength="32"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">E-mail[$svInputRequired]</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Mail" value="[Var:'vUser_Email']" size="30" maxlength="64"> 				Notify?				<input type="radio" name="Notify" value="Y" [If:(Var:'vUser_Notify')=='Y' || (Var:'vUser_Notify')=='']checked[/If]>Yes &nbsp;				<input type="radio" name="Notify" value="N" [If:(Var:'vUser_Notify')=='N']checked[/If]>No			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Chat</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Chat" value="[Var:'vUser_Chat']" size="24" maxlength="64"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Website</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Website" value="[Var:'vUser_Website']" size="30" maxlength="64"> 			</td>		</tr>		<tr>			<td width="120" valign="top" class="tablehead_10_white_right">Address</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="Address1" value="[Var:'vUser_Address1']" size="30" maxlength="64"><br>				<input type="text" name="Address2" value="[Var:'vUser_Address2']" size="30" maxlength="64"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">City,<br>State (Province),<br>Zip (Postal Code)</td>			<td valign="top" bgcolor="#f0f0f0">				<input type="text" name="City" value="[Var:'vUser_City']" size="20" maxlength="32"><br><?Lassoscript				Var:'SQLSelectStates' = ('SELECT * FROM ' $svStatesTable);				Inline: $IV_States, -Table=$svStatesTable, -SQL=$SQLSelectStates;					'\t\t\t\t<select name="State">\n';					'\t\t\t\t\t<option value=""'; If: (Var:'vState_Abbrev') == ''; ' selected'; /If; '></option>\n';					Records;						'\t\t\t\t\t<option value="'(Field:'State_Abbrev')'"'; If: (Var:'vState_Abbrev') == (Field:'State_Abbrev'); ' selected'; /If; '>'(Field:'State_Name')'</option>\n';					/Records;					'\t\t\t\t</select>\n';		        /Inline;?>		        <br>				<input type="text" name="Zip" value="[Var:'vUser_Zip']" size="8" maxlength="12"> 			</td>		</tr>		<tr>			<td width="120" class="tablehead_10_white_right">Country</td>			<td valign="top" bgcolor="#f0f0f0">				<select name="Country"> 					<option value=""[If: (Var:'vUser_Country') == ''] selected[/If]></option>					<option value="USA"[If: (Var:'vUser_Country') == 'USA'] selected[/If]>USA</option>					<option value="Canada"[If: (Var:'vUser_Country') == 'Canada'] selected[/If]>Canada</option>					<option value="Other"[If: (Var:'vUser_Country') == 'Other'] selected[/If]>Other</option>				</select> 			</td>		</tr>		<tr>			<td width="120" valign="top" class="tablehead_10_white_right">Comments</td>			<td valign="top" bgcolor="#f0f0f0">				<textarea name="Comments" cols="60" rows="4">[Var:'vUser_Comments']</textarea>			</td>		</tr><?Lassoscript// Show Last Access only if it is an edit pageIf: (Response_Filepath) >> 'setup_editrecord.lasso';?>		<tr>			<td width="120" class="tablehead_10_white_right">Last Access</td>			<td valign="top" bgcolor="#f0f0f0">				[Var:'vUser_LastAccess']			</td>		</tr>[/If]		<tr>			<td colspan="2" bgcolor="#666666">				<div align="center"><?Lassoscript// If Edit page, add a hidden field to show check if page is submit// Also add a hidden field with the User_IDIf: (Response_Filepath) >> 'setup_editrecord.lasso';				'\t\t\t\t<input type="hidden" name="Process" value="Y">\n';				'\t\t\t\t<input type="hidden" name="ID" value="'($vUser_ID)'">\n';				'\t\t\t\t<input type="hidden" name="DataType" value="User">\n';				'\t\t\t\t<input type="submit" name="Action" value="Update">\n';Else;				'\t\t\t\t<input type="hidden" name="DataType" value="User">\n';				'\t\t\t\t<input type="submit" name="Action" value="Add">\n';/If; ?>				</div>			</td>		</tr>	</table></form><br>